---
import Layout from '../layouts/Layout.astro';

const title = "Free YouTube Sentiment Analyzer ‚Äì Instantly Summarize Video Comments";
const description = "Paste any YouTube video link and get an instant summary of comment sentiment: see if viewers love or hate a video in seconds. Free, no login needed.";
const url = "https://youtube-sentiment-analyzer.vercel.app";
const image = "/og-image.svg";
---
<Layout>
  <head>
    <title>{title}</title>
    <meta name="description" content={description} />
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={url} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={image} />
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={url} />
    <meta property="twitter:title" content={title} />
    <meta property="twitter:description" content={description} />
    <meta property="twitter:image" content={image} />
    <!-- Additional SEO -->
    <meta name="robots" content="index, follow" />
    <meta name="author" content="YouTube Sentiment Analyzer" />
    <meta name="keywords" content="youtube, sentiment analysis, comment analysis, video sentiment, ai analysis, free tool" />
    <link rel="canonical" href={url} />
  </head>

  <main class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center px-4 py-8">
    <div class="max-w-4xl w-full mx-auto">
      <div class="bg-white rounded-2xl shadow-xl p-8 md:p-12">
        <div class="text-center mb-8">
          <h1 class="text-4xl md:text-5xl font-bold text-gray-800 mb-4">
            YouTube Sentiment Analyzer
          </h1>
          <p class="text-lg text-gray-600 leading-relaxed">
            Paste any YouTube video link below to get instant sentiment analysis of the comments.
            Discover what viewers really think about the content with AI-powered insights.
          </p>
        </div>

        <form id="analysis-form" class="space-y-6">
          <div>
            <label for="youtube-url" class="block text-sm font-medium text-gray-700 mb-2">
              YouTube Video URL
            </label>
            <input
              type="url"
              id="youtube-url"
              name="youtube-url"
              placeholder="https://www.youtube.com/watch?v=..."
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200 text-gray-900 placeholder-gray-500"
              required
            />
          </div>
          <button
            type="submit"
            id="analyze-button"
            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-200 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed"
          >
            Analyze Sentiment
          </button>
        </form>

        <!-- Loading State -->
        <div id="loading-state" class="hidden mt-8 text-center">
          <div class="inline-flex items-center space-x-2">
            <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"></div>
            <span class="text-gray-600" id="loading-text">Fetching comments...</span>
          </div>
        </div>

        <!-- Error State -->
        <div id="error-state" class="hidden mt-8 p-4 bg-red-50 border border-red-200 rounded-lg">
          <div class="flex items-center">
            <svg class="w-5 h-5 text-red-400 mr-2" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
            </svg>
            <span class="text-red-800 font-medium">Error:</span>
            <span class="text-red-700 ml-1" id="error-message"></span>
          </div>
        </div>

        <!-- Video & Channel Info Card -->
        <div id="video-info" class="mb-8 flex items-center space-x-4 hidden">
          <img id="video-thumb" class="w-20 h-20 rounded shadow object-cover" alt="Video thumbnail">
          <div>
            <h2 id="video-title" class="font-semibold text-lg"></h2>
            <a id="channel-link" href="#" class="text-blue-600 font-medium flex items-center" target="_blank" rel="noopener">
              <img id="channel-thumb" class="w-8 h-8 rounded-full mr-2 object-cover" alt="Channel thumbnail">
              <span id="channel-title"></span>
            </a>
            <p id="channel-desc" class="text-gray-500 text-xs mt-1"></p>
          </div>
        </div>

        <!-- Results -->
        <div id="results-container" class="hidden mt-8 space-y-6">
          <div id="sample-info" class="mb-4 text-sm text-blue-700 font-medium hidden"></div>
          <div id="most-liked-callout" class="mb-6 p-4 bg-yellow-50 border-l-4 border-yellow-400 rounded shadow hidden">
            <div class="flex items-center mb-2">
              <span class="text-xl mr-2">üëç</span>
              <span class="font-bold text-gray-800" id="most-liked-label"></span>
            </div>
            <blockquote class="text-gray-700 italic" id="most-liked-text"></blockquote>
          </div>
          <div class="bg-gray-50 rounded-xl p-6">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">Sentiment Analysis</h3>
            <div class="space-y-3">
              <div class="flex items-center justify-between">
                <span class="text-sm font-medium text-green-700">Positive</span>
                <span class="text-sm font-bold text-green-700" id="positive-percentage">0%</span>
              </div>
              <div class="w-full bg-gray-200 rounded-full h-3">
                <div class="bg-green-500 h-3 rounded-full transition-all duration-500" id="positive-bar" style="width: 0%"></div>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-sm font-medium text-gray-700">Neutral</span>
                <span class="text-sm font-bold text-gray-700" id="neutral-percentage">0%</span>
              </div>
              <div class="w-full bg-gray-200 rounded-full h-3">
                <div class="bg-gray-500 h-3 rounded-full transition-all duration-500" id="neutral-bar" style="width: 0%"></div>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-sm font-medium text-red-700">Negative</span>
                <span class="text-sm font-bold text-red-700" id="negative-percentage">0%</span>
              </div>
              <div class="w-full bg-gray-200 rounded-full h-3">
                <div class="bg-red-500 h-3 rounded-full transition-all duration-500" id="negative-bar" style="width: 0%"></div>
              </div>
            </div>
            <div class="mt-6 p-4 bg-blue-50 rounded-lg">
              <h4 class="text-sm font-medium text-blue-900 mb-2">Summary</h4>
              <p class="text-blue-800" id="sentiment-summary" style="white-space: pre-line;"></p>
            </div>
          </div>
          <div class="grid md:grid-cols-3 gap-6">
            <div class="bg-green-50 rounded-lg p-4">
              <h4 class="text-lg font-semibold text-green-800 mb-3 flex items-center">
                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                </svg>
                Positive
              </h4>
              <div id="positive-comments" class="space-y-2"></div>
            </div>
            <div class="bg-gray-50 rounded-lg p-4">
              <h4 class="text-lg font-semibold text-gray-800 mb-3 flex items-center">
                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm0-2a6 6 0 100-12 6 6 0 000 12zm0-9a1 1 0 011 1v4a1 1 0 11-2 0V8a1 1 0 011-1z" clip-rule="evenodd"></path>
                </svg>
                Neutral
              </h4>
              <div id="neutral-comments" class="space-y-2"></div>
            </div>
            <div class="bg-red-50 rounded-lg p-4">
              <h4 class="text-lg font-semibold text-red-800 mb-3 flex items-center">
                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                </svg>
                Negative
              </h4>
              <div id="negative-comments" class="space-y-2"></div>
            </div>
          </div>
        </div>
        <div class="mt-8 text-center">
          <p class="text-sm text-gray-500">
            Powered by AI ‚Ä¢ Fast ‚Ä¢ Accurate ‚Ä¢ Free
          </p>
        </div>
      </div>
    </div>
  </main>

  <!-- AdSense Ad Placement -->
  <section class="py-8 bg-gray-50">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center">
        <div class="bg-white border-2 border-dashed border-gray-300 rounded-lg p-8">
          <div class="text-gray-500">
            <h3 class="text-lg font-medium mb-2">Advertisement</h3>
            <p class="text-sm">AdSense ad will be displayed here</p>
            <div class="mt-4 w-full h-32 bg-gray-100 rounded flex items-center justify-center">
              <span class="text-gray-400">728x90 Ad Unit</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- FAQ Section -->
  <section id="faq" class="bg-gray-50 py-16">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-12">
        <h2 class="text-3xl font-bold text-gray-900 mb-4">Frequently Asked Questions</h2>
        <p class="text-lg text-gray-600">Everything you need to know about our YouTube sentiment analyzer</p>
      </div>
      <div class="space-y-8">
        <!-- FAQ Item 1 -->
        <div class="bg-white rounded-lg shadow-sm p-6">
          <h3 class="text-xl font-semibold text-gray-900 mb-4">How does this YouTube Sentiment Analyzer work?</h3>
          <p class="text-gray-700 mb-4">
            Our YouTube sentiment analyzer uses advanced AI technology to analyze the emotional tone of video comments. When you paste a YouTube URL, our system first extracts the video ID and fetches up to 100 of the most relevant comments using the YouTube Data API v3. These comments are then processed through OpenAI's GPT-4o model, which has been specifically trained to understand context, sarcasm, and nuanced emotional expressions.
          </p>
          <p class="text-gray-700">
            The AI analyzes each comment and categorizes it as positive, neutral, or negative sentiment. It then provides you with percentage breakdowns, a summary of the overall sentiment, and sample comments from each category. This process typically takes just a few seconds and gives you instant insights into how viewers are responding to the video content.
          </p>
        </div>
        <!-- FAQ Item 2 -->
        <div class="bg-white rounded-lg shadow-sm p-6">
          <h3 class="text-xl font-semibold text-gray-900 mb-4">Is this tool free to use?</h3>
          <p class="text-gray-700 mb-4">
            Yes, our YouTube sentiment analyzer is completely free to use! We believe in providing accessible tools for content creators, marketers, and researchers who want to understand audience sentiment without any cost barriers. You can analyze as many YouTube videos as you need without any subscription fees, hidden charges, or usage limits.
          </p>
          <p class="text-gray-700">
            Our goal is to democratize sentiment analysis and make it available to everyone, from individual YouTubers looking to understand their audience better to businesses conducting market research. Simply paste any YouTube URL and get instant, professional-grade sentiment analysis results at no cost.
          </p>
        </div>
        <!-- FAQ Item 3 -->
        <div class="bg-white rounded-lg shadow-sm p-6">
          <h3 class="text-xl font-semibold text-gray-900 mb-4">Do you store any of my data?</h3>
          <p class="text-gray-700 mb-4">
            No, we do not store any of your data or the YouTube comments we analyze. Our sentiment analyzer processes everything in real-time and immediately discards the data once the analysis is complete. We prioritize your privacy and data security - the YouTube URLs you submit, the comments we fetch, and the sentiment analysis results are never saved to our servers or databases.
          </p>
          <p class="text-gray-700">
            Each analysis is completely independent and temporary. When you submit a YouTube URL, we fetch the comments, analyze the sentiment, return the results to you, and then all data is automatically purged from our system. This ensures complete privacy and means that your analysis activity cannot be tracked or stored by us.
          </p>
        </div>
        <!-- FAQ Item 4 -->
        <div class="bg-white rounded-lg shadow-sm p-6">
          <h3 class="text-xl font-semibold text-gray-900 mb-4">What types of YouTube videos can I analyze?</h3>
          <p class="text-gray-700 mb-4">
            You can analyze any public YouTube video that has comments enabled. Our sentiment analyzer works with all types of content including vlogs, tutorials, music videos, product reviews, educational content, and entertainment videos. The tool supports various YouTube URL formats including standard watch URLs (youtube.com/watch?v=), shortened URLs (youtu.be/), and embedded URLs.
          </p>
          <p class="text-gray-700">
            For best results, we recommend analyzing videos that have at least 10-20 comments, as this provides a more representative sample for sentiment analysis. Videos with thousands of comments will give you the most comprehensive insights into audience sentiment and engagement patterns.
          </p>
        </div>
        <!-- FAQ Item 5 -->
        <div class="bg-white rounded-lg shadow-sm p-6">
          <h3 class="text-xl font-semibold text-gray-900 mb-4">How accurate is the sentiment analysis?</h3>
          <p class="text-gray-700 mb-4">
            Our sentiment analyzer uses OpenAI's GPT-4o model, which is one of the most advanced AI language models available. This ensures high accuracy in understanding context, detecting sarcasm, and interpreting complex emotional expressions that simpler sentiment analysis tools might miss. The AI has been trained on vast amounts of text data and can understand nuanced language patterns.
          </p>
          <p class="text-gray-700">
            While no automated sentiment analysis is 100% perfect, our tool typically achieves accuracy rates comparable to human analysts. The AI considers factors like emoji usage, capitalization, punctuation patterns, and contextual clues to make informed sentiment classifications. For the most reliable results, we analyze multiple comments and provide sample comments so you can verify the classifications yourself.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="bg-gray-900 text-white py-12">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="grid md:grid-cols-3 gap-8">
        <!-- Brand Section -->
        <div class="space-y-4">
          <h3 class="text-xl font-bold">YouTube Sentiment Analyzer</h3>
          <p class="text-gray-300 text-sm">
            Free AI-powered tool for analyzing YouTube video comment sentiment. Get instant insights into audience reactions and engagement.
          </p>
          <div class="flex space-x-4">
            <a href="#" class="text-gray-400 hover:text-white transition-colors">
              <!-- You can add social SVG icons here if you want -->
            </a>
          </div>
        </div>
        <div></div>
        <div></div>
      </div>
      <div class="border-t border-gray-800 mt-8 pt-8 flex flex-col md:flex-row justify-between items-center">
        <p class="text-gray-400 text-sm">
          ¬© 2025 YouTube Sentiment Analyzer. All rights reserved.
        </p>
        <div class="flex space-x-6 mt-4 md:mt-0">
          <a href="/privacy" class="text-gray-400 hover:text-white text-sm transition-colors">Privacy Policy</a>
          <span class="text-gray-600">‚Ä¢</span>
          <a href="mailto:tomasbeltran2014@gmail.com" class="text-gray-400 hover:text-white text-sm transition-colors">Contact</a>
        </div>
      </div>
    </div>
  </footer>

  <!-- Cookie Notice -->
  <div id="cookie-notice" class="fixed bottom-0 left-0 right-0 bg-gray-900 text-white p-4 z-50 transform translate-y-full transition-transform duration-300">
    <div class="max-w-6xl mx-auto flex flex-col sm:flex-row items-center justify-between">
      <div class="text-sm mb-4 sm:mb-0">
        <p>We use cookies to enhance your experience. By continuing to use this site, you agree to our use of cookies.
        <a href="/privacy" class="text-blue-400 hover:text-blue-300 underline">Learn more</a></p>
      </div>
      <div class="flex space-x-3">
        <button id="accept-cookies" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm transition-colors">
          Accept
        </button>
        <button id="decline-cookies" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded text-sm transition-colors">
          Decline
        </button>
      </div>
    </div>
  </div>

  <!-- JSON-LD Schema -->
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "YouTube Sentiment Analyzer",
      "url": "https://youtube-sentiment-analyzer.vercel.app",
      "description": "Paste any YouTube video link and get an instant summary of comment sentiment: see if viewers love or hate a video in seconds. Free, no login needed.",
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://youtube-sentiment-analyzer.vercel.app/?video={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    }
  </script>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    // Get DOM elements
    const form = document.getElementById('analysis-form');
    const urlInput = document.getElementById('youtube-url');
    const analyzeButton = document.getElementById('analyze-button');
    const loadingState = document.getElementById('loading-state');
    const loadingText = document.getElementById('loading-text');
    const errorState = document.getElementById('error-state');
    const errorMessage = document.getElementById('error-message');
    const resultsContainer = document.getElementById('results-container');
    const positivePercentage = document.getElementById('positive-percentage');
    const neutralPercentage = document.getElementById('neutral-percentage');
    const negativePercentage = document.getElementById('negative-percentage');
    const positiveBar = document.getElementById('positive-bar');
    const neutralBar = document.getElementById('neutral-bar');
    const negativeBar = document.getElementById('negative-bar');
    const sentimentSummary = document.getElementById('sentiment-summary');
    const positiveComments = document.getElementById('positive-comments');
    const neutralComments = document.getElementById('neutral-comments');
    const negativeComments = document.getElementById('negative-comments');
    const sampleInfo = document.getElementById('sample-info');
    const mostLikedCallout = document.getElementById('most-liked-callout');
    const mostLikedLabel = document.getElementById('most-liked-label');
    const mostLikedText = document.getElementById('most-liked-text');
    // Video Info Card elements
    const videoInfoCard = document.getElementById('video-info');
    const videoThumb = document.getElementById('video-thumb');
    const videoTitle = document.getElementById('video-title');
    const channelLink = document.getElementById('channel-link');
    const channelThumb = document.getElementById('channel-thumb');
    const channelTitle = document.getElementById('channel-title');
    const channelDesc = document.getElementById('channel-desc');

    function hideAllStates() {
      loadingState?.classList.add('hidden');
      errorState?.classList.add('hidden');
      resultsContainer?.classList.add('hidden');
      sampleInfo?.classList.add('hidden');
      mostLikedCallout?.classList.add('hidden');
      videoInfoCard?.classList.add('hidden');
    }

    function showLoading(message) {
      hideAllStates();
      loadingText.textContent = message;
      loadingState?.classList.remove('hidden');
      analyzeButton.disabled = true;
    }

    function showError(message) {
      hideAllStates();
      errorMessage.textContent = message;
      errorState?.classList.remove('hidden');
      analyzeButton.disabled = false;
    }

    function showResults(data, meta = {}) {
      hideAllStates();

      // VIDEO & CHANNEL INFO CARD
      if (meta.videoInfo && meta.channelInfo) {
        // Video thumbnail
        if (meta.videoInfo.title && meta.videoInfo.channelId) {
          const videoIdMatch = urlInput.value.match(/(?:v=|be\/|embed\/|v\/)([a-zA-Z0-9_-]{11})/);
          const videoId = videoIdMatch ? videoIdMatch[1] : null;
          if (videoId) {
            videoThumb.src = `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`;
            videoThumb.alt = meta.videoInfo.title;
          }
        }
        videoTitle.textContent = meta.videoInfo.title || '';
        if (meta.channelInfo.channelCustomUrl) {
          channelLink.href = `https://www.youtube.com/${meta.channelInfo.channelCustomUrl}`;
        } else if (meta.videoInfo.channelId) {
          channelLink.href = `https://www.youtube.com/channel/${meta.videoInfo.channelId}`;
        } else {
          channelLink.href = "#";
        }
        let thumbUrl = meta.channelInfo.channelThumbnails?.high?.url
          || meta.channelInfo.channelThumbnails?.default?.url
          || meta.channelInfo.channelThumbnails?.medium?.url
          || '';
        if (thumbUrl) {
          channelThumb.src = thumbUrl;
        } else {
          channelThumb.removeAttribute('src');
        }
        channelTitle.textContent = meta.channelInfo.channelTitle || '';
        channelDesc.textContent = meta.channelInfo.channelDescription || '';
        videoInfoCard.classList.remove('hidden');
      } else {
        videoInfoCard.classList.add('hidden');
      }

      // Sample Size & Most Liked Comment
      if (meta.analyzedCount && meta.totalComments) {
        if (meta.totalComments <= meta.analyzedCount) {
          sampleInfo.textContent = `Analyzed all ${meta.analyzedCount} comments for this video.`;
        } else {
          sampleInfo.textContent = `Analyzed a randomized sample of ${meta.analyzedCount} out of ${meta.totalComments} comments.`;
        }
        sampleInfo.classList.remove('hidden');
      } else {
        sampleInfo.classList.add('hidden');
      }
      if (meta.mostLiked && meta.mostLiked.text && typeof meta.mostLiked.likeCount === 'number') {
        mostLikedLabel.textContent = `Most liked comment (${meta.mostLiked.likeCount} likes):`;
        mostLikedText.textContent = `"${meta.mostLiked.text}"`;
        mostLikedCallout.classList.remove('hidden');
      } else {
        mostLikedCallout.classList.add('hidden');
      }

      positivePercentage.textContent = `${data.positive}%`;
      neutralPercentage.textContent = `${data.neutral}%`;
      negativePercentage.textContent = `${data.negative}%`;
      setTimeout(() => {
        positiveBar.style.width = `${data.positive}%`;
        neutralBar.style.width = `${data.neutral}%`;
        negativeBar.style.width = `${data.negative}%`;
      }, 100);
      sentimentSummary.textContent = data.summary;
      updateComments(positiveComments, data.sampleComments.positive, 'text-green-700');
      updateComments(neutralComments, data.sampleComments.neutral, 'text-gray-700');
      updateComments(negativeComments, data.sampleComments.negative, 'text-red-700');

      resultsContainer.classList.remove('hidden');
      analyzeButton.disabled = false;
    }

    function updateComments(container, comments, textColor) {
      container.innerHTML = '';
      comments.forEach(comment => {
        const commentDiv = document.createElement('div');
        commentDiv.className = `text-sm ${textColor} bg-white p-3 rounded-lg border border-gray-200`;
        commentDiv.textContent = `"${comment}"`;
        container.appendChild(commentDiv);
      });
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const youtubeUrl = urlInput.value.trim();
      if (!youtubeUrl) {
        showError('Please enter a YouTube URL');
        return;
      }

      try {
        showLoading('Fetching comments...');
        const commentsResponse = await fetch('/api/comments', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ youtubeUrl }),
        });
        if (!commentsResponse.ok) {
          const errorData = await commentsResponse.json();
          throw new Error(errorData.error || 'Failed to fetch comments');
        }
        const commentsData = await commentsResponse.json();
        if (!commentsData.comments || commentsData.comments.length === 0) {
          throw new Error('No comments found for this video');
        }

        showLoading('Analyzing sentiment...');
        const sentimentResponse = await fetch('/api/sentiment', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            comments: commentsData.comments,
            analyzedCount: commentsData.analyzedCount,
            totalComments: commentsData.totalComments,
            mostLiked: commentsData.mostLiked,
            videoInfo: commentsData.videoInfo,
            channelInfo: commentsData.channelInfo,
          }),
        });
        if (!sentimentResponse.ok) {
          const errorData = await sentimentResponse.json();
          throw new Error(errorData.error || 'Failed to analyze sentiment');
        }
        const sentimentData = await sentimentResponse.json();

        showResults(sentimentData, {
          analyzedCount: commentsData.analyzedCount,
          totalComments: commentsData.totalComments,
          mostLiked: commentsData.mostLiked,
          videoInfo: sentimentData.videoInfo,
          channelInfo: sentimentData.channelInfo,
        });
      } catch (error) {
        console.error('Analysis error:', error);
        showError(error instanceof Error ? error.message : 'An unexpected error occurred');
      }
    });

    // Cookie Notice
    const cookieNotice = document.getElementById('cookie-notice');
    const acceptCookies = document.getElementById('accept-cookies');
    const declineCookies = document.getElementById('decline-cookies');
    const cookieChoice = localStorage.getItem('cookieChoice');
    if (!cookieChoice) {
      setTimeout(() => {
        cookieNotice.classList.remove('translate-y-full');
      }, 1000);
    }
    acceptCookies.addEventListener('click', () => {
      localStorage.setItem('cookieChoice', 'accepted');
      cookieNotice.classList.add('translate-y-full');
    });
    declineCookies.addEventListener('click', () => {
      localStorage.setItem('cookieChoice', 'declined');
      cookieNotice.classList.add('translate-y-full');
    });
  });
  </script>
</Layout>
